import gradio as gr
import pandas as pd
from xgboost import XGBClassifier

# Load your dataset (this will be used for training)
DIR = "/content/drive/MyDrive/workspace/Orders/00145"
CATEGORICAL_COLUMNS = ['—Å–æ—Å—Ç–æ—è–Ω–∏–µ', '–æ–∫—Ä—É–≥', '–º–µ—Ç—Ä–æ', '–ø–µ—à–∫–æ–º/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º', '–∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è', '–≥–æ—Ä–æ–¥']
NUMERICAL_COLUMNS = ['–æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å', '—ç—Ç–∞–∂', '–≤—Ä–µ–º—è –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏', '–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞', '—à–∏—Ä–æ—Ç–∞', '–¥–æ–ª–≥–æ—Ç–∞', '—Ü–µ–Ω–∞ –∑–∞ –º–µ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è']
COLUMNS = CATEGORICAL_COLUMNS + NUMERICAL_COLUMNS

nan_fill_values = {
    "–æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å" : 182.0,
    "—ç—Ç–∞–∂" : 1.0,
    "–≤—Ä–µ–º—è –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏" : 8.0,
    "–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞" : 9.0,
    "—à–∏—Ä–æ—Ç–∞" : 55.74993,
    "–¥–æ–ª–≥–æ—Ç–∞" : 37.58892,
    "—Ü–µ–Ω–∞ –∑–∞ –º–µ—Ç—Ä –æ–±—ä—è–≤–ª–µ–Ω–∏—è" : 314110.0,
    "—Å–æ—Å—Ç–æ—è–Ω–∏–µ" : "–¢–∏–ø–æ–≤–æ–π —Ä–µ–º–æ–Ω—Ç",
    "–æ–∫—Ä—É–≥" : "–¶–ê–û",
    "–º–µ—Ç—Ä–æ" : "–ö–æ–º–º—É–Ω–∞—Ä–∫–∞",
    "–ø–µ—à–∫–æ–º/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º" : "–ø–µ—à–∫–æ–º",
    "–∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è" : "–ü–æ–º–µ—â–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–ø—Ä–æ–¥–∞–∂–∞)",
    "–≥–æ—Ä–æ–¥" : "–ú–æ—Å–∫–≤–∞",
    'distance_from_center': 10
}

metro_values = ['–ë—É–ª—å–≤–∞—Ä –ê–¥–º–∏—Ä–∞–ª–∞ –£—à–∞–∫–æ–≤–∞', '–ü—Ä–æ–∫—à–∏–Ω–æ', '–û–ª—å—Ö–æ–≤–∞—è', '–ö—É–Ω—Ü–µ–≤—Å–∫–∞—è',
 '–ê–≤–∏–∞–º–æ—Ç–æ—Ä–Ω–∞—è', '–ü–æ—Ç–∞–ø–æ–≤–æ', '–§—Ä—É–Ω–∑–µ–Ω—Å–∫–∞—è', '–ö–æ–ø—Ç–µ–≤–æ', '–°—É—Ö–∞—Ä–µ–≤—Å–∫–∞—è',
 '–ù–∞–≥–æ—Ä–Ω–∞—è', '–ü—Ä–æ–ª–µ—Ç–∞—Ä—Å–∫–∞—è', '–ü–æ–¥—Ä–µ–∑–∫–æ–≤–æ', '–¢—É—à–∏–Ω—Å–∫–∞—è', '–ö—Ä–∞—Å–Ω–æ—Å–µ–ª—å—Å–∫–∞—è',
 '–ü—Ä–µ–æ–±—Ä–∞–∂–µ–Ω—Å–∫–∞—è –ø–ª–æ—â–∞–¥—å', '–õ–∏–∞–Ω–æ–∑–æ–≤–æ', '–î–º–∏—Ç—Ä–æ–≤—Å–∫–∞—è', '–ö–æ–º–º—É–Ω–∞—Ä–∫–∞',
 '–í–∞—Ä—à–∞–≤—Å–∫–∞—è', '–ë—É–Ω–∏–Ω—Å–∫–∞—è –∞–ª–ª–µ—è', '–ú–µ–¥–≤–µ–¥–∫–æ–≤–æ', '–°–æ–ª–Ω—Ü–µ–≤–æ', '–†–æ—Å—Ç–æ–∫–∏–Ω–æ',
 '–ü–∞–≤–µ–ª–µ—Ü–∫–∞—è', '–ú–∏—á—É—Ä–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '–ú—è–∫–∏–Ω–∏–Ω–æ', '–ö—Ä–∞—Å–Ω—ã–π –ë–∞–ª—Ç–∏–µ—Ü',
 '–ë–µ–ª–æ—Ä—É—Å—Å–∫–∞—è', '–ü–µ—Ä–æ–≤–æ', '–ö—É—Ä—Å–∫–∞—è', '–ö—Ä–∞—Å–Ω–æ–ø—Ä–µ—Å–Ω–µ–Ω—Å–∫–∞—è',
 '–ë—É–ª—å–≤–∞—Ä –†–æ–∫–æ—Å—Å–æ–≤—Å–∫–æ–≥–æ', '–©—É–∫–∏–Ω—Å–∫–∞—è', '–ö—Ä–µ—Å—Ç—å—è–Ω—Å–∫–∞—è –∑–∞—Å—Ç–∞–≤–∞', '–ö–∞—Ö–æ–≤—Å–∫–∞—è',
 '–ó–æ—Ä–≥–µ', '–í–æ—Ä–æ–Ω—Ü–æ–≤—Å–∫–∞—è', '–û–∫—Ä—É–∂–Ω–∞—è', '–û—Ç—Ä–∞–¥–Ω–æ–µ', '–Ø—Å–µ–Ω–µ–≤–æ', '–ê–≤—Ç–æ–∑–∞–≤–æ–¥—Å–∫–∞—è',
 '–ë–∞—É–º–∞–Ω—Å–∫–∞—è', '–¢—Ä–∏–∫–æ—Ç–∞–∂–Ω–∞—è', '–ó–µ–ª–µ–Ω–æ–≥—Ä–∞–¥ ‚Äî –ö—Ä—é–∫–æ–≤–æ', '–ù–∞–≥–∞—Ç–∏–Ω—Å–∫–∞—è',
 '–ü–µ—Ä–≤–æ–º–∞–π—Å–∫–∞—è', '–ú–∞—Ä—å–∏–Ω–∞ –†–æ—â–∞', '–ö—Ä—ã–ª–∞—Ç—Å–∫–æ–µ', '–ú–∞—è–∫–æ–≤—Å–∫–∞—è', '–¢—É–ª—å—Å–∫–∞—è',
 '–°—Ä–µ—Ç–µ–Ω—Å–∫–∏–π –±—É–ª—å–≤–∞—Ä', '–©—ë–ª–∫–æ–≤—Å–∫–∞—è', '–¢–µ—Ö–Ω–æ–ø–∞—Ä–∫', '–ê–ª–µ–∫—Å–µ–µ–≤—Å–∫–∞—è',
 '–ö–∏—Ç–∞–π-–≥–æ—Ä–æ–¥', '–†–µ—á–Ω–æ–π –≤–æ–∫–∑–∞–ª', '–ö—É—á–∏–Ω–æ', '–ê–º–∏–Ω—å–µ–≤—Å–∫–∞—è', '–¶–°–ö–ê', '–°—Ç—Ä–æ–≥–∏–Ω–æ',
 '–Æ–∂–Ω–∞—è', '–ù–æ–≤–æ–∫–æ—Å–∏–Ω–æ', '–°–º–æ–ª–µ–Ω—Å–∫–∞—è', '–•–∏–º–∫–∏', '–ö—Ä–æ–ø–æ—Ç–∫–∏–Ω—Å–∫–∞—è', '–°–ø–∞—Ä—Ç–∞–∫',
 '–Æ–≥–æ-–ó–∞–ø–∞–¥–Ω–∞—è', '–û–∫—Ç—è–±—Ä—å—Å–∫–æ–µ –ø–æ–ª–µ', '–õ–æ–∫–æ–º–æ—Ç–∏–≤', '–ù–µ–∫—Ä–∞—Å–æ–≤–∫–∞', '–¢–∞–≥–∞–Ω—Å–∫–∞—è',
 '–ü—Ä–æ—Å–ø–µ–∫—Ç –ú–∏—Ä–∞', '–õ–µ–Ω–∏–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '–†–∞–±–æ—á–∏–π –ø–æ—Å—ë–ª–æ–∫', '–ü–æ–ª—è–Ω–∫–∞',
 '–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫–∞—è', '–≠–ª–µ–∫—Ç—Ä–æ–∑–∞–≤–æ–¥—Å–∫–∞—è', '–ü–µ—Ç—Ä–æ–≤—Å–∫–æ-–†–∞–∑—É–º–æ–≤—Å–∫–∞—è', '–°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è',
 '–ê—Ä–±–∞—Ç—Å–∫–∞—è', '–¢–≤–µ—Ä—Å–∫–∞—è', '–¶–≤–µ—Ç–Ω–æ–π –±—É–ª—å–≤–∞—Ä', '–®–∞–±–æ–ª–æ–≤—Å–∫–∞—è', '–ù–æ–≤–æ–≥–∏—Ä–µ–µ–≤–æ',
 '–£–ª–∏—Ü–∞ –ê–∫–∞–¥–µ–º–∏–∫–∞ –Ø–Ω–≥–µ–ª—è', '–ê–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∞—è', '–£–ª–∏—Ü–∞ 1905 –≥–æ–¥–∞', '–ú–∏–Ω—Å–∫–∞—è',
 '–ú–æ—Å–∫–≤–∞-–°–∏—Ç–∏', '–§–∏–ª–∏', '–ß—É—Ö–ª–∏–Ω–∫–∞', '–î–æ–º–æ–¥–µ–¥–æ–≤—Å–∫–∞—è', '–õ—é–±–µ—Ä—Ü—ã', '–ù–æ–≤–∞—Ç–æ—Ä—Å–∫–∞—è',
 '–ü–æ–∫–ª–æ–Ω–Ω–∞—è', '–ö—É—Ä—å—è–Ω–æ–≤–æ', '–ë–∞—Ä—Ä–∏–∫–∞–¥–Ω–∞—è', '–§–∏–∑—Ç–µ—Ö', '–ö–∏–µ–≤—Å–∫–∞—è', '–ö—É—Ç—É–∑–æ–≤—Å–∫–∞—è',
 '–ü—É—à–∫–∏–Ω—Å–∫–∞—è', '–ê–ª—Ç—É—Ñ—å–µ–≤–æ', '–ö–æ—Ç–µ–ª—å–Ω–∏–∫–∏', '–®–æ—Å—Å–µ –≠–Ω—Ç—É–∑–∏–∞—Å—Ç–æ–≤', '–ó–ò–õ',
 '–†—è–∑–∞–Ω—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '–•–æ–≤—Ä–∏–Ω–æ', '–ü–∞—Ä–∫ –ö—É–ª—å—Ç—É—Ä—ã', '–ü—Ä–æ—Ñ—Å–æ—é–∑–Ω–∞—è', '–ò–∑–º–∞–π–ª–æ–≤–æ',
 '–î–∏–Ω–∞–º–æ', '–õ–æ–º–æ–Ω–æ—Å–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '–ë–∞–ª—Ç–∏–π—Å–∫–∞—è', '–ö–∞–ª–∏—Ç–Ω–∏–∫–∏', '–ê–Ω–Ω–∏–Ω–æ',
 '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç', '–í–µ—Ä—Ö–Ω–∏–µ –õ–∏—Ö–æ–±–æ—Ä—ã', '–°–≤–∏–±–ª–æ–≤–æ', '–ë–µ–≥–æ–≤–∞—è', '–ë–∞–±—É—à–∫–∏–Ω—Å–∫–∞—è',
 '–ü–ª—é—â–µ–≤–æ', '–°–µ—Ä–ø—É—Ö–æ–≤—Å–∫–∞—è', '–ö–æ–ª–æ–º–µ–Ω—Å–∫–∞—è', '–ë–æ—Ä–∏—Å–æ–≤–æ', '–•–æ—Ä–æ—à—ë–≤–æ', '–î–∞–≤—ã–¥–∫–æ–≤–æ',
 '–ü–æ–¥–æ–ª—å—Å–∫', '–ß–∏—Å—Ç—ã–µ –ø—Ä—É–¥—ã', '–ú–∞—Ä—å–∏–Ω–æ', '–£–ª–∏—Ü–∞ –°–∫–æ–±–µ–ª–µ–≤—Å–∫–∞—è', '–°—Ö–æ–¥–Ω–µ–Ω—Å–∫–∞—è',
 '–õ–µ—Ä–º–æ–Ω—Ç–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '–í–î–ù–•', '–ú–∞—Ä–∫—Å–∏—Å—Ç—Å–∫–∞—è', '–ö–æ–∂—É—Ö–æ–≤—Å–∫–∞—è', '–°–æ–∫–æ–ª',
 '–ö–æ–Ω—å–∫–æ–≤–æ', '–°–∞–≤—ë–ª–æ–≤—Å–∫–∞—è', '–ú–æ–ª–æ–¥—ë–∂–Ω–∞—è', '–ü—è—Ç–Ω–∏—Ü–∫–æ–µ —à–æ—Å—Å–µ', '–ë–µ–ª–æ–º–æ—Ä—Å–∫–∞—è',
 '–¶–∞—Ä–∏—Ü—ã–Ω–æ', '–ñ—É–ª–µ–±–∏–Ω–æ', '–û–∑—ë—Ä–Ω–∞—è', '–¢–µ–∫—Å—Ç–∏–ª—å—â–∏–∫–∏', '–ù–∏–∂–µ–≥–æ—Ä–æ–¥—Å–∫–∞—è', '–ü—Ä–∞–∂—Å–∫–∞—è',
 '–ß–∫–∞–ª–æ–≤—Å–∫–∞—è', '–ö–∞–Ω—Ç–µ–º–∏—Ä–æ–≤—Å–∫–∞—è', '–ù–∞—Ö–∏–º–æ–≤—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '–ö—É–∑—å–º–∏–Ω–∫–∏',
 '–í–æ–π–∫–æ–≤—Å–∫–∞—è', '–¢–µ–∞—Ç—Ä–∞–ª—å–Ω–∞—è', '–ü–∞–≤—à–∏–Ω–æ', '–°–µ–ª–∏–≥–µ—Ä—Å–∫–∞—è', '–î–µ–≥—É–Ω–∏–Ω–æ',
 '–ë–æ—Ç–∞–Ω–∏—á–µ—Å–∫–∏–π —Å–∞–¥', '–†–∏–º—Å–∫–∞—è', '–ù–æ–≤–æ—è—Å–µ–Ω–µ–≤—Å–∫–∞—è', '–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è',
 '–ò–∑–º–∞–π–ª–æ–≤—Å–∫–∞—è', '–ë—Ä–∞—Ç–∏—Å–ª–∞–≤—Å–∫–∞—è', '–ú–∏—Ç–∏–Ω–æ', '–í–æ–ª–æ–∫–æ–ª–∞–º—Å–∫–∞—è', '–õ—É—Ö–º–∞–Ω–æ–≤—Å–∫–∞—è',
 '–°—Ç–∞—Ö–∞–Ω–æ–≤—Å–∫–∞—è', '–û–ø–∞–ª–∏—Ö–∞', '–û—Å—Ç—Ä–æ–≤ –º–µ—á—Ç—ã', '–ö—Ä–∞—Å–Ω—ã–µ –≤–æ—Ä–æ—Ç–∞', '–ü–ª–æ—â–∞–¥—å –ò–ª—å–∏—á–∞',
 '–ù–∞—Ä–æ–¥–Ω–æ–µ –û–ø–æ–ª—á–µ–Ω–∏–µ', '–í–æ–¥–Ω—ã–π —Å—Ç–∞–¥–∏–æ–Ω', '–û—á–∞–∫–æ–≤–æ', '–©–µ—Ä–±–∏–Ω–∫–∞', '–õ—é–±–ª–∏–Ω–æ',
 '–í–∞–≤–∏–ª–æ–≤—Å–∫–∞—è', '–ú–æ–ª–∂–∞–Ω–∏–Ω–æ–≤–æ', '–§–∏—Ä—Å–∞–Ω–æ–≤—Å–∫–∞—è', '–ú–æ—Å—Å–µ–ª—å–º–∞—à',
 '–ë—É–ª—å–≤–∞—Ä –î–º–∏—Ç—Ä–∏—è –î–æ–Ω—Å–∫–æ–≥–æ', '–¢–∏–º–∏—Ä—è–∑–µ–≤—Å–∫–∞—è', '–†–∞–º–µ–Ω–∫–∏', '–õ–µ–≤–æ–±–µ—Ä–µ–∂–Ω–∞—è',
 '–í–æ–ª–∂—Å–∫–∞—è', '–ß–µ—Ä–∫–∏–∑–æ–≤—Å–∫–∞—è', '–í–æ–ª–≥–æ–≥—Ä–∞–¥—Å–∫–∏–π –ø—Ä–æ—Å–ø–µ–∫—Ç', '–°—Ö–æ–¥–Ω—è',
 '–£–ª–∏—Ü–∞ –î–º–∏—Ç—Ä–∏–µ–≤—Å–∫–æ–≥–æ', '–î—É–±—Ä–æ–≤–∫–∞', '–°–∏–ª–∏–∫–∞—Ç–Ω–∞—è', '–ù–æ–≤–æ—Å–ª–æ–±–æ–¥—Å–∫–∞—è',
 '–ù–æ–≤–æ–ø–µ—Ä–µ–¥–µ–ª–∫–∏–Ω–æ', '–û–∫—Å–∫–∞—è', '–ö–∞—Ä–∞–º—ã—à–µ–≤—Å–∫–∞—è', '–£–ª–∏—Ü–∞ –ì–æ—Ä—á–∞–∫–æ–≤–∞', '–í–ª–∞–¥—ã–∫–∏–Ω–æ',
 '–ü–µ—Ç—Ä–æ–≤—Å–∫–∏–π –ü–∞—Ä–∫', '–°–æ–∫–æ–ª—å–Ω–∏–∫–∏', '–¢—Ä—É–±–Ω–∞—è', '–¢—Ä–æ–ø–∞—Ä—ë–≤–æ', '–†–∏–∂—Å–∫–∞—è',
 '–î–æ–±—Ä—ã–Ω–∏–Ω—Å–∫–∞—è', '–ù–æ–≤—ã–µ –ß–µ—Ä—ë–º—É—à–∫–∏', '–ë—É—Ç—ã—Ä—Å–∫–∞—è', '–í–µ—Ä—Ö–Ω–∏–µ –∫–æ—Ç–ª—ã', '–®–µ–ª–µ–ø–∏—Ö–∞',
 '–ü–∞–Ω—Ñ–∏–ª–æ–≤—Å–∫–∞—è', '–ü–ª–∞–Ω–µ—Ä–Ω–∞—è', '–õ–æ–±–Ω—è', '–õ–µ—Å–æ–ø–∞—Ä–∫–æ–≤–∞—è', '–ü–æ–ª–µ–∂–∞–µ–≤—Å–∫–∞—è',
 '–ö–∞–ª—É–∂—Å–∫–∞—è', '–û–∫—Ç—è–±—Ä—å—Å–∫–∞—è', '–ö–∞—à–∏—Ä—Å–∫–∞—è', '–ì–æ–≤–æ—Ä–æ–≤–æ', '–•–æ—Ä–æ—à—ë–≤—Å–∫–∞—è',
 '–§–∏–ª—ë–≤—Å–∫–∏–π –ø–∞—Ä–∫', '–ü–∞—Ä–∫ –ü–æ–±–µ–¥—ã', '–°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∞—è', '–ê—ç—Ä–æ–ø–æ—Ä—Ç', '–ú–Ω—ë–≤–Ω–∏–∫–∏',
 '–ù–æ–≤–æ–∫—É–∑–Ω–µ—Ü–∫–∞—è', '–°—Ç—Ä–µ—à–Ω–µ–≤–æ', '–ü–µ—Ä–µ—Ä–≤–∞', '–î–æ—Å—Ç–æ–µ–≤—Å–∫–∞—è', '–°–µ–º—ë–Ω–æ–≤—Å–∫–∞—è',
 '–°–µ—Ç—É–Ω—å', '–ë–æ—Ä–æ–≤–∏—Ü–∫–∞—è', '–°–∞–ª—Ç—ã–∫–æ–≤—Å–∫–∞—è', '–ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è', '–ñ–µ–ª–µ–∑–Ω–æ–¥–æ—Ä–æ–∂–Ω–∞—è',
 '–ú–æ—Å–∫–≤–∞-–¢–æ–≤–∞—Ä–Ω–∞—è', '–û—Ö–æ—Ç–Ω—ã–π —Ä—è–¥', '–Ø—Ö—Ä–æ–º—Å–∫–∞—è', '–õ—É–±—è–Ω–∫–∞', '–¢—Ä–µ—Ç—å—è–∫–æ–≤—Å–∫–∞—è',
 '–î–µ–ª–æ–≤–æ–π —Ü–µ–Ω—Ç—Ä', '–î–µ–ø–æ', '–§–∏–ª–∞—Ç–æ–≤ –õ—É–≥', '–õ–∏—Ö–æ–±–æ—Ä—ã', '–ë–µ–ª—è–µ–≤–æ', '–ú–æ—Å–∫–≤–æ—Ä–µ—á—å–µ',
 '–†–µ—É—Ç–æ–≤', '–ß–µ—Ö–æ–≤—Å–∫–∞—è', '–£—Ö—Ç–æ–º—Å–∫–∞—è', '–ù–æ–≤–æ–ø–æ–¥—Ä–µ–∑–∫–æ–≤–æ', '–°–ª–∞–≤—è–Ω—Å–∫–∏–π –±—É–ª—å–≤–∞—Ä',
 '–í–æ–¥–Ω–∏–∫–∏', '–ë–∏–±–∏—Ä–µ–≤–æ', '–ü–µ—á–∞—Ç–Ω–∏–∫–∏', '–ü—Ä–æ—Å–ø–µ–∫—Ç –í–µ—Ä–Ω–∞–¥—Å–∫–æ–≥–æ', '–ü–µ–Ω—è–≥–∏–Ω–æ',
 '–ó—é–∑–∏–Ω–æ', '–°–æ–∫–æ–ª–∏–Ω–∞—è –≥–æ—Ä–∞', '–ö—Ä–∞—Å–Ω—ã–π –°—Ç—Ä–æ–∏—Ç–µ–ª—å', '–®–∏–ø–∏–ª–æ–≤—Å–∫–∞—è',
 '–ë–∏—Ç—Ü–µ–≤—Å–∫–∏–π –ø–∞—Ä–∫', '–£–ª–∏—Ü–∞ –°—Ç–∞—Ä–æ–∫–∞—á–∞–ª–æ–≤—Å–∫–∞—è', '–£–ª–∏—Ü–∞ –°–µ—Ä–≥–µ—è –≠–π–∑–µ–Ω—à—Ç–µ–π–Ω–∞',
 '–ê–Ω–∏–∫–µ–µ–≤–∫–∞', '–ú–∞—Ç–≤–µ–µ–≤—Å–∫–∞—è', '–ö–∞—Å–ø–∏–π—Å–∫–∞—è', '–ü–∞–Ω–∫–∏', '–ö—Ä—ã–º—Å–∫–∞—è', '–¢—É—Ä–≥–µ–Ω–µ–≤—Å–∫–∞—è',
 '–õ–µ—Ñ–æ—Ä—Ç–æ–≤–æ', '–§–æ–Ω–≤–∏–∑–∏–Ω—Å–∫–∞—è', '–¢–µ–ª–µ—Ü–µ–Ω—Ç—Ä', '–ú–µ–Ω–¥–µ–ª–µ–µ–≤—Å–∫–∞—è', '–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –ë–æ—Ä',
 '–ù–æ–≤–æ—Ö–æ—Ö–ª–æ–≤—Å–∫–∞—è', '–®–µ—Ä–µ–º–µ—Ç—å–µ–≤—Å–∫–∞—è', '–í–æ—Ä–æ–±—å—ë–≤—ã –≥–æ—Ä—ã', '–Æ–≥–æ-–í–æ—Å—Ç–æ—á–Ω–∞—è',
 '–¢—ë–ø–ª—ã–π –°—Ç–∞–Ω', '–£–≥—Ä–µ—à—Å–∫–∞—è', '–£–ª–∏—Ü–∞ –ê–∫–∞–¥–µ–º–∏–∫–∞ –ö–æ—Ä–æ–ª—ë–≤–∞', '–ü–ª–æ—â–∞–¥—å –ì–∞–≥–∞—Ä–∏–Ω–∞',
 '–ó—è–±–ª–∏–∫–æ–≤–æ', '–ö—É–∑–Ω–µ—Ü–∫–∏–π –º–æ—Å—Ç', '–ë–æ—Ä–æ–≤—Å–∫–æ–µ —à–æ—Å—Å–µ', '–ü–∞—Ä—Ç–∏–∑–∞–Ω—Å–∫–∞—è',
 '–•–ª–µ–±–Ω–∏–∫–æ–≤–æ', '–í—ã—Ö–∏–Ω–æ', '–ü–∏–æ–Ω–µ—Ä—Å–∫–∞—è', '–ë–µ—Å–∫—É–¥–Ω–∏–∫–æ–≤–æ', '–ì—Ä–∞—á—ë–≤—Å–∫–∞—è',
 '–ö—Ä–∞—Å–Ω–æ–≥–≤–∞—Ä–¥–µ–π—Å–∫–∞—è', '–ê–Ω–¥—Ä–æ–Ω–æ–≤–∫–∞', '–ë–∞–≥—Ä–∞—Ç–∏–æ–Ω–æ–≤—Å–∫–∞—è', '–ê–ª–º–∞-–ê—Ç–∏–Ω—Å–∫–∞—è',
 '–ù–µ–º—á–∏–Ω–æ–≤–∫–∞', '–•–æ—Ä–æ—à–µ–≤–æ', '–ë—É—Ç–æ–≤–æ', '–£–ª–∏—Ü–∞ –ú–∏–ª–∞—à–µ–Ω–∫–æ–≤–∞', '–ü–æ–∫—Ä–æ–≤—Å–∫–æ–µ',
 '–û—Ä–µ—Ö–æ–≤–æ', '–°–∞–ª–∞—Ä—å–µ–≤–æ', '–õ–µ—Ç–æ–≤–æ', '–ö–∞–≤–∫–∞–∑—Å–∫–∏–π –±—É–ª—å–≤–∞—Ä', '–ß–µ—Ä—Ç–∞–Ω–æ–≤—Å–∫–∞—è',
 '–û–ª—å–≥–∏–Ω–æ', '–°—É–≤–æ—Ä–æ–≤—Å–∫–∞—è', '–ö–æ—Å–∏–Ω–æ', '–ù–∏–∫–æ–ª—å—Å–∫–æ–µ', '–ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤—Å–∫–∏–π —Å–∞–¥',
 '–ë–µ–ª–æ–∫–∞–º–µ–Ω–Ω–∞—è', '–ö—É—Å–∫–æ–≤–æ', '–ü–ª–æ—â–∞–¥—å —Ç—Ä—ë—Ö –≤–æ–∫–∑–∞–ª–æ–≤', '–°–æ—Ä—Ç–∏—Ä–æ–≤–æ—á–Ω–∞—è',
 '–î–æ–ª–≥–æ–ø—Ä—É–¥–Ω–∞—è', '–ú–µ—â–µ—Ä—Å–∫–∞—è', '–ú–∞—Ä–∫', '–õ—É–∂–Ω–∏–∫–∏', '–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –∏–º. –õ–µ–Ω–∏–Ω–∞',
 '–ë–∏—Ä—é–ª—ë–≤–æ', '–ë—É–ª—å–≤–∞—Ä –ì–µ–Ω–µ—Ä–∞–ª–∞ –ö–∞—Ä–±—ã—à–µ–≤–∞', '–°–∫–æ–ª–∫–æ–≤–æ', '–ö–ª–µ–Ω–æ–≤—ã–π –±—É–ª—å–≤–∞—Ä',
 '–†–∞—Å—Å–∫–∞–∑–æ–≤–∫–∞', '–ì–æ–ª—å—è–Ω–æ–≤–æ', '–ü–ª–æ—â–∞–¥—å –†–µ–≤–æ–ª—é—Ü–∏–∏', '–ù–æ–≤–æ–¥–∞—á–Ω–∞—è', '–¢–µ—Ä–µ—Ö–æ–≤–æ',
 '–í–µ—à–Ω—è–∫–∏', '–ë–∏—Ç—Ü–∞', '–°–µ—Ä–ø –∏ –ú–æ–ª–æ—Ç', '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç –î—Ä—É–∂–±—ã –ù–∞—Ä–æ–¥–æ–≤',
 '–°–µ–≤–∞—Å—Ç–æ–ø–æ–ª—å—Å–∫–∞—è', '–ù–∞–≥–∞—Ç–∏–Ω—Å–∫–∏–π –ó–∞—Ç–æ–Ω']
okrug_values = ['–ù–ê–û (–ù–æ–≤–æ–º–æ—Å–∫–æ–≤—Å–∫–∏–π)', '–ó–ê–û', '–í–ê–û', '–¶–ê–û', '–°–ê–û', '–Æ–ê–û', '–°–ó–ê–û', '–°–í–ê–û',
 '–Æ–ó–ê–û', '–Æ–í–ê–û', '–ó–µ–ª–ê–û']
category_values = ['–ü–æ–º–µ—â–µ–Ω–∏–µ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è (–ø—Ä–æ–¥–∞–∂–∞)', '–û—Ñ–∏—Å (–ø—Ä–æ–¥–∞–∂–∞)',
 '–ó–¥–∞–Ω–∏–µ (–ø—Ä–æ–¥–∞–∂–∞)', '–¢–æ—Ä–≥–æ–≤–∞—è –ø–ª–æ—â–∞–¥—å (–ø—Ä–æ–¥–∞–∂–∞)']
city_values = ['–°–æ—Å–µ–Ω—Å–∫–æ–µ –ø–æ—Å–µ–ª–µ–Ω–∏–µ', '–ú–æ—Å–∫–≤–∞', '–•–∏–º–∫–∏', '–õ—é–±–µ—Ä—Ü—ã', '–ú—ã—Ç–∏—â–∏', '–ë–∞–ª–∞—à–∏—Ö–∞',
 '–ö—Ä–∞—Å–Ω–æ–≥–æ—Ä—Å–∫', '–ü–æ–¥–æ–ª—å—Å–∫']
condition_values = ['–¢–∏–ø–æ–≤–æ–π —Ä–µ–º–æ–Ω—Ç', '–ü–æ–¥ —á–∏—Å—Ç–æ–≤—É—é –æ—Ç–¥–µ–ª–∫—É',
 '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–∞–ø–∏—Ç–∞–ª—å–Ω—ã–π —Ä–µ–º–æ–Ω—Ç', '–î–∏–∑–∞–π–Ω–µ—Ä—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç',
 '–¢—Ä–µ–±—É–µ—Ç—Å—è –∫–æ—Å–º–µ—Ç–∏—á–µ—Å–∫–∏–π —Ä–µ–º–æ–Ω—Ç', '–û—Ñ–∏—Å–Ω–∞—è –æ—Ç–¥–µ–ª–∫–∞']
transport_values = ['—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º', '–ø–µ—à–∫–æ–º']


# load `/content/xgb_model_1.pkl`
import pickle
import xgboost as xgb


# Path to the saved XGBoost model

# Load the model using pickle
with open('./models/xgb_model_1.pkl', 'rb') as model_file:
    xgb_model_1 = pickle.load(model_file)

with open('./models/xgb_model_2.pkl', 'rb') as model_file:
    xgb_model_2 = pickle.load(model_file)

# with open('/content/mlp_model_1.pkl', 'rb') as model_file:
#     xgb_model_1 = pickle.load(model_file)

models = {
  "xgb_1" : xgb_model_1,
  "xgb_2" : xgb_model_2,
  #"mlp_1" : mlp_model_1
}

from geopy.distance import great_circle


# Define the prediction function
def predict_user_input(*user_input_values):
    # Initialize a dictionary with all model features set to 0

    user_input_keys = ["–ú–µ—Ç—Ä–æ", "–û–∫—Ä—É–≥", "–ì–æ—Ä–æ–¥", "–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è", "–°–æ—Å—Ç–æ—è–Ω–∏–µ", "–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å","–≠—Ç–∞–∂", "–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞", "–í—Ä–µ–º—è –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏", "–ø–µ—à–∫–æ–º/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º", "–®–∏—Ä–æ—Ç–∞", "–î–æ–ª–≥–æ—Ç–∞"]
    print(user_input_values)
    user_input = dict(zip(user_input_keys, user_input_values))
    model = models[user_input_values[-1]]
    input_data = {feature: 0 for feature in model.feature_names_in_}

    # Map the numerical fields directly
    input_data['–æ–±—â–∞—è –ø–ª–æ—â–∞–¥—å'] = user_input['–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å']
    input_data['—ç—Ç–∞–∂'] = user_input['–≠—Ç–∞–∂']
    input_data['–≤—Ä–µ–º—è –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏'] = user_input['–í—Ä–µ–º—è –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏']
    input_data['–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞'] = user_input['–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞']
    input_data['—à–∏—Ä–æ—Ç–∞'] = user_input['–®–∏—Ä–æ—Ç–∞']
    input_data['–¥–æ–ª–≥–æ—Ç–∞'] = user_input['–î–æ–ª–≥–æ—Ç–∞']

    # Set one-hot encoded fields
    # —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    state_feature = f"—Å–æ—Å—Ç–æ—è–Ω–∏–µ_{user_input['–°–æ—Å—Ç–æ—è–Ω–∏–µ']}"
    if state_feature in input_data:
        input_data[state_feature] = 1

    # –æ–∫—Ä—É–≥
    district_feature = f"–æ–∫—Ä—É–≥_{user_input['–û–∫—Ä—É–≥']}"
    if district_feature in input_data:
        input_data[district_feature] = 1

    # –º–µ—Ç—Ä–æ
    metro_feature = f"–º–µ—Ç—Ä–æ_{user_input['–ú–µ—Ç—Ä–æ']}"
    if metro_feature in input_data:
        input_data[metro_feature] = 1

    # –ø–µ—à–∫–æ–º/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º
    walk_transit_feature = f"–ø–µ—à–∫–æ–º/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º_{user_input['–ø–µ—à–∫–æ–º/—Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º']}"
    if walk_transit_feature in input_data:
        input_data[walk_transit_feature] = 1

    # –∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è
    category_feature = f"–∫–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è_{user_input['–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è']}"
    if category_feature in input_data:
        input_data[category_feature] = 1

    # Convert the dictionary into a DataFrame (single-row) to pass to the model
    input_df = pd.DataFrame([input_data])

    # Optional: Print the resulting DataFrame to check if it's correctly prepared
    # Coordinates of Moscow city center
    moscow_center_coords = (55.7558, 37.6173)

    # Calculate the distance from Moscow's center
    input_df['distance_from_center'] = input_df.apply(
        lambda row: great_circle((row['—à–∏—Ä–æ—Ç–∞'], row['–¥–æ–ª–≥–æ—Ç–∞']), moscow_center_coords).kilometers, axis=1
    )

    # Now, the input_df can be passed to the XGBoost model for predictions
    predictions = model.predict(input_df)

    return predictions[0]

import gradio as gr

# Create Gradio interface
with gr.Blocks() as interface:
    # Title and description with an image for branding
    gr.Markdown("""
    # üèôÔ∏è –ü—Ä–æ–≥–Ω–æ–∑ —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏
    ### –í–≤–µ–¥–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –æ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å –æ—Ü–µ–Ω–∫—É —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –º–µ—Ç—Ä
    """)
    # Grouping inputs into collapsible sections for better organization
    with gr.Accordion("–ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞"):
        inputs = []
        inputs.append(gr.Dropdown(choices=metro_values, label="–ú–µ—Ç—Ä–æ", info="–í—ã–±–µ—Ä–∏—Ç–µ –±–ª–∏–∂–∞–π—à—É—é —Å—Ç–∞–Ω—Ü–∏—é –º–µ—Ç—Ä–æ"))
        inputs.append(gr.Dropdown(choices=okrug_values, label="–û–∫—Ä—É–≥", info="–í—ã–±–µ—Ä–∏—Ç–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–π –æ–∫—Ä—É–≥"))
        inputs.append(gr.Dropdown(choices=city_values, label="–ì–æ—Ä–æ–¥", info="–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥"))

    with gr.Accordion("–î–µ—Ç–∞–ª–∏ –æ–±—ä–µ–∫—Ç–∞"):
        inputs.append(gr.Dropdown(choices=category_values, label="–ö–∞—Ç–µ–≥–æ—Ä–∏—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è", info="–í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏"))
        inputs.append(gr.Dropdown(choices=condition_values, label="–°–æ—Å—Ç–æ—è–Ω–∏–µ", info="–í—ã–±–µ—Ä–∏—Ç–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–±—ä–µ–∫—Ç–∞"))
        inputs.append(gr.Slider(label='–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å (–º¬≤)', minimum=10, maximum=300, value=30, step=1, info="–û–±—â–∞—è –ø–ª–æ—â–∞–¥—å –≤ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã—Ö –º–µ—Ç—Ä–∞—Ö"))
        inputs.append(gr.Slider(label='–≠—Ç–∞–∂', minimum=1, maximum=50, value=2, step=1, info="–ù–æ–º–µ—Ä —ç—Ç–∞–∂–∞ –∫–≤–∞—Ä—Ç–∏—Ä—ã"))
        inputs.append(gr.Slider(label='–≠—Ç–∞–∂–Ω–æ—Å—Ç—å –¥–æ–º–∞', minimum=1, maximum=50, value=5, step=1, info="–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç—Ç–∞–∂–µ–π –≤ –¥–æ–º–µ"))

    with gr.Accordion("–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å"):
        inputs.append(gr.Slider(label='–í—Ä–µ–º—è –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)', minimum=1, maximum=60, value=5, step=1, info="–í—Ä–µ–º—è –¥–æ –±–ª–∏–∂–∞–π—à–µ–π —Å—Ç–∞–Ω—Ü–∏–∏ (–º–∏–Ω—É—Ç—ã)"))
        inputs.append(gr.Dropdown(choices=transport_values, value="–ø–µ—à–∫–æ–º", label='–î–æ —Å—Ç–∞–Ω—Ü–∏–∏', info="–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± –ø–µ—Ä–µ–¥–≤–∏–∂–µ–Ω–∏—è –¥–æ —Å—Ç–∞–Ω—Ü–∏–∏"))

    with gr.Accordion("–ì–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã"):
        inputs.append(gr.Number(label='–®–∏—Ä–æ—Ç–∞', info="–®–∏—Ä–æ—Ç–∞ –æ–±—ä–µ–∫—Ç–∞"))
        inputs.append(gr.Number(label='–î–æ–ª–≥–æ—Ç–∞', info="–î–æ–ª–≥–æ—Ç–∞ –æ–±—ä–µ–∫—Ç–∞"))

    # New section for selecting the model
    with gr.Accordion("–í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è"):
        model_selection = gr.Radio(
            choices=list(models.keys()),
            label="–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å",
            info="–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è —Å—Ç–æ–∏–º–æ—Å—Ç–∏"
        )

    # Adding a nice divider to make it visually appealing
    gr.Markdown("---")

    # Display the prediction result
    output = gr.Textbox(label="üí≤ –û—Ü–µ–Ω–∫–∞ —Ü–µ–Ω—ã –∑–∞ –∫–≤–∞–¥—Ä–∞—Ç–Ω—ã–π –º–µ—Ç—Ä")

    # Button to trigger prediction with a different color
    submit_btn = gr.Button("üìä –û—Ü–µ–Ω–∏—Ç—å", variant="primary")

    # Add a spinner or loading indicator while prediction is being made
    with gr.Row():
        with gr.Column():
            submit_btn.click(fn=predict_user_input, inputs=inputs + [model_selection], outputs=output)
            gr.Markdown("#### ‚è≥ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ, –ø–æ–∫–∞ –∏–¥–µ—Ç —Ä–∞—Å—á–µ—Ç –æ—Ü–µ–Ω–∫–∏...")

# Launch the Gradio interface
interface.launch(server_name="0.0.0.0", server_port=8080)

